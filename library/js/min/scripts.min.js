var GameObject;GameObject=function(){function t(t){this.state=t,this.isAlien=!1,this.id=Utils.uuid(),this.state.GameObjects[this.id]=this}return t.prototype.update=function(){},t.prototype.destroy=function(){return delete this.state.GameObjects[this.id]},t}();var GameOver;GameOver={preload:function(){},create:function(){var t,e,i;game.add.sprite(0,0,"background"),i=game.add.text(game.world.centerX,150,"Blind Aliens",{font:"65px Arial",fill:"#ffffff",align:"center"}),i.anchor.setTo(.5,.5),t=game.add.text(game.world.centerX,250,"Game Over!",{font:"32px Arial",fill:"#ff3333",align:"center"}),t.anchor.setTo(.5,.5),e=game.add.text(game.world.centerX,350,"Score: "+game.state.states.play.score,{font:"24px Arial",fill:"#dddddd",align:"center"}),e.anchor.setTo(.5,.5)},update:function(){game.input.activePointer.justPressed()&&game.state.start("menu")}};var Menu;Menu={preload:function(){return game.load.image("background","library/assets/background.png")},create:function(){var t,e,i;game.add.sprite(0,0,"background"),i=game.add.text(game.world.centerX,150,"Blind Aliens",{font:"65px Arial",fill:"#ffffff",align:"center"}),i.anchor.setTo(.5,.5),t=game.add.text(game.world.centerX,500,"Click anywhere to play the game",{font:"24px Arial",fill:"#ff7777",align:"center"}),t.anchor.setTo(.5,.5),e=game.add.text(game.world.centerX,350,"You are trapped in a room with blind aliens.\n Sneak or run. Hide or shoot. Just stay alive.\n \n Controls:\n 1. Move using W, A, S, D, or ↑, ←, ↓, →\n 3. Use your mouse to aim and shoot\n 3. Pause/resume by hitting spacebar",{font:"24px Arial",fill:"#bbbbbb",align:"center"}),e.anchor.setTo(.5,.5)},update:function(){game.input.activePointer.justPressed()&&game.state.start("play")}};var Play;Play=function(){function t(){}return t.prototype.preload=function(){return game.load.image("shadowmask","library/assets/shadowmask.png"),game.load.image("side_shadows","library/assets/side_shadows.png"),game.load.image("player","library/assets/player.png"),game.load.image("circle","library/assets/circle.png"),game.load.image("bullet","library/assets/bullet.png"),game.load.image("ammo","library/assets/ammo.png"),game.load.spritesheet("enemy","library/assets/alien_spreadsheet_350_402.png",350,402,4),game.load.audio("footstep","library/assets/footstep.m4a"),game.load.audio("gunshot","library/assets/gunshot.wav")},t.prototype.create=function(){this.GameState={numAliens:0,numAmmoBoxes:0},this.GameObjects={},this.backdropPlayer=game.add.group(),this.aliens=game.add.group(),this.shadows=game.add.group(),this.hud=game.add.group(),game.physics.startSystem(Phaser.Physics.ARCADE),this.backdropPlayer.create(0,0,"background"),this.player=new Player(game.width/2,game.height/2,this),this.shadows.create(0,0,"side_shadows"),this.score=0,this.count=0,this.scoreboard=game.add.text(16,16,"Score: 0\nAmmo: 10 / 10",{fontSize:"32px",fill:"#FFF"}),this.hud.add(this.scoreboard),t.pauseText=game.add.text(game.world.centerX,game.world.centerY,"",{font:"bold 32px Arial",fill:"#ffffff",align:"center"}),t.pauseText.anchor.setTo(.5,.5),game.input.keyboard.onDownCallback=this.pauseOrResume},t.prototype.newAlien=function(t){var e,i,s;return e=2*Math.random()*(game.width+game.height),e<game.width?(i=e,s=-40):e<2*game.width?(i=e-game.width,s=40+game.height):e<2*game.width+game.height?(s=e-2*game.width,i=-40):(s=e-(2*game.width+game.height),i=40+game.width),new Alien(i,s,this,t),this.GameState.numAliens+=1},t.prototype.newAmmoBox=function(){var t,e;return t=Math.random()*(game.width-200)+100,e=Math.random()*(game.height-200)+100,new AmmoBox(t,e,this),this.GameState.numAmmoBoxes+=1},t.prototype.update=function(){var t,e,i,s,o,r,a;0===this.count%20&&(this.score=this.score+1),this.scoreboard.text="Score: "+this.score.toString()+"\nAmmo: "+this.player.bullets.toString()+" / 10",0===this.count%100&&this.GameState.numAmmoBoxes<1&&this.newAmmoBox(),this.count=this.count+1,s=this.score/600+2,i=this.score/300+2,(this.GameState.numAliens<s&&Math.random()<.03||Math.random()<5e-4&&this.GameState.numAliens<i)&&(t=Math.floor(Math.random()*this.score/1e3),this.newAlien(t)),r=this.GameObjects,a=[];for(e in r)o=r[e],a.push(o.update());return a},t.prototype.drawCircles=function(t){var e,i,s,o;for(o=Physics.calculateCircles(t),i=0,s=o.length;s>i;i++)e=o[i],game.debug.geom(new Phaser.Circle(e.x,e.y,2*e.radius),"#ffffff",!1)},t.prototype.render=function(){"play"===game.state.current&&debugging===!0&&(this.aliens.forEach(function(t){return function(e){return t.drawCircles(e)}}(this)),this.drawCircles(this.player.sprite))},t.prototype.pauseOrResume=function(){"play"===game.state.current&&game.input.keyboard.justPressed(Phaser.Keyboard.SPACEBAR)&&(null==this.lastClick||game.time.now-this.lastClick>50)&&(this.lastClick=game.time.now,game.paused?(game.paused=!1,t.pauseText.text=""):(t.pauseText.text="Game Paused",game.paused=!0))},t}();var Physics;Physics={collides:function(t,e){var i,s,o,r,a,h,n,d;for(o=this.calculateCircles(t),r=this.calculateCircles(e),a=0,n=o.length;n>a;a++)for(i=o[a],h=0,d=r.length;d>h;h++)if(s=r[h],Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2)<=Math.pow(i.radius+s.radius,2))return console.log(i,s),!0;return!1},calculateCircles:function(t){var e,i,s,o,r,a,h,n,d,p,c;for(n=[],c=t.physicsBody,d=0,p=c.length;p>d;d++)e=c[d],i=(e.x-t.anchor.x)*t.body.width,s=(e.y-t.anchor.y)*t.body.height,a=Math.sqrt(i*i+s*s),h=t.rotation+Math.PI-Math.atan2(i,s),o=a*Math.sin(h),r=-a*Math.cos(h),n.push({x:t.body.x+t.body.width*t.anchor.x+o,y:t.body.y+t.body.height*t.anchor.y+r,radius:e.radius*t.scale.x});return n}};var Utils;Utils={},Utils.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e,i;return e=16*Math.random()|0,i="x"===t?e:3&e|8,i.toString(16)})},Utils.dist=function(t,e){var i,s;return i=t.x-e.x,s=t.y-e.y,Math.sqrt(i*i+s*s)};var Alien,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var s in e)__hasProp.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Alien=function(t){function e(t,i,s,o){var r,a;e.__super__.constructor.call(this,s),this.type="alien",this.big=o,this.SCORE_VALUE=100*(o+1),this.sprite=game.add.sprite(t,i,"enemy"),this.state.aliens.add(this.sprite),this.sprite.wrapper=this,this.sprite.scale.setTo(.15*(o+1),.15*(o+1)),game.physics.arcade.enable(this.sprite),this.sprite.animations.add("crawl"),this.crawl=this.sprite.play("crawl",8,!0),this.sprite.anchor.setTo(.5,.5),this.sprite.alpha=1,this.sprite.physicsBody=[{x:.5,y:.5,radius:125}],this.alive=o+2,this.stunCountdown=0,r=200+Math.random()*(game.width-400),a=200+Math.random()*(game.height-400),t=this.sprite.body.x+this.sprite.width/2,i=this.sprite.body.y+this.sprite.height/2,this.sprite.angle=180/Math.PI*Math.atan2(r-t,-(a-i)),this.soundCountdown=0,this.moveCountdown=30,this.dtheta=0,this.dr=1,this.returnQuantity=2,this.locationNotTouched=0,this.locationx=0,this.locationy=0,this.locationCountdown=0}return __extends(e,t),e.prototype.update=function(){var t,e,i,s,o;if(this.sprite.bringToTop(),i=this.sprite.body.x+this.sprite.width/2,s=this.sprite.body.y+this.sprite.height/2,(-100>i||-100>s||i>game.width+100||s>game.height+100)&&(this.destroy(),this.state.score+=this.SCORE_VALUE),this.alive>0){o=this.state.GameObjects;for(t in o)e=o[t],"alien"===e.type&&e.alive>0&&game.physics.arcade.collide(this.sprite,e.sprite),"bullet"===e.type&&game.physics.arcade.collide(this.sprite,e.sprite,null,this._hitByBullet,this);if(this.sprite.body.velocity.x*=.97,this.sprite.body.velocity.y*=.97,this.moveCountdown>0&&(this.moveCountdown=this.moveCountdown-1),this.soundCountdown>0&&(this.soundCountdown=this.soundCountdown-1),this.locationCountdown>0&&(this.locationCountdown=this.locationCountdown-1),!(this.stunCountdown>0))return this._walk();if(this.stunCountdown=this.stunCountdown-1,this.stunCountdown<=0)return this.crawl.isPaused=!1}else if(this.sprite.body.acceleration.x=0,this.sprite.body.acceleration.y=0,this.sprite.body.velocity.x*=.97,this.sprite.body.velocity.y*=.97,this.sprite.alpha=this.sprite.alpha-.01,this.crawl.isPaused=!0,this.sprite.alpha<=0)return this.destroy()},e.prototype._hitByBullet=function(t,e){return t.wrapper.state.score=t.wrapper.state.score+t.wrapper.SCORE_VALUE,t.wrapper.crawl.isPaused=!0,t.wrapper.stunCountdown=60,t.wrapper.alive=t.wrapper.alive-1,t.tint=16777215-257*Math.floor(255*(t.wrapper.big+4-t.wrapper.alive)/(t.wrapper.big+4)),t.body.velocity.x+=e.body.velocity.x/10,t.body.velocity.y+=e.body.velocity.y/10,t.body.acceleration.x=0,t.body.acceleration.y=0,e.wrapper.destroy(),!1},e.prototype._walk=function(){var t,e,i,s,o,r,a;return this.moveCountdown>0?(this.sprite.angle+=this.dtheta,o=Math.sin(this.sprite.angle*Math.PI/180),a=Math.cos(this.sprite.angle*Math.PI/180),i=2===this.alive?2:1.7,i*=Math.pow(1.5,this.big),this.sprite.body.velocity.x=this.dr*o*50*i,this.sprite.body.velocity.y=-this.dr*a*50*i):(this.sprite.body.acceleration.x=0,this.sprite.body.acceleration.y=0,this.moveCountdown=20*Math.random()+15,this.dtheta=Math.random()>.33?4*Math.random()-2:0,this.dr=0===this.dtheta?.8+.2*Math.random():0,s=this.sprite.body.x+this.sprite.width/2,r=this.sprite.body.y+this.sprite.height/2,(0>s||0>r||s>game.width||r>game.height)&&this.returnQuantity>0&&(this.returnQuantity-=1,this.returnQuantity%2===1?(t=200+Math.random()*(game.width-400),e=200+Math.random()*(game.height-400),this._target(t,e)):(this.dtheta=0,this.dr=.8+.2*Math.random())),1===this.locationNotTouched?(this._target(this.locationx,this.locationy),this.dr=this.moveCountdown<70?1:.5,this.dtheta*=2,this.moveCountdown=5,((s-this.locationx)*(s-this.locationx)+(r-this.locationy)*(r-this.locationy)<=400||0===this.locationCountdown)&&(this.locationNotTouched=0),this.soundCountdown=this.soundCountdown+1):void 0)},e.prototype._target=function(t,e){var i,s,o;return s=this.sprite.body.x+this.sprite.width/2,o=this.sprite.body.y+this.sprite.height/2,this.dtheta=1,this.dr=0,i=180/Math.PI*Math.atan2(t-s,-(e-o)),this.moveCountdown=(i-this.sprite.angle+360)%360,this.moveCountdown>180&&(this.dtheta=-1),this.moveCountdown>180?this.moveCountdown=360-this.moveCountdown:void 0},e.prototype.hear=function(t,e,i){var s,o,r,a;return r=this.sprite.body.x+this.sprite.width/2,a=this.sprite.body.y+this.sprite.height/2,s=(r-t)*(r-t)+(a-e)*(a-e),i*i>=s?(o=Math.sqrt(s)/10,this.locationx=t+2*Math.random()*o-o,this.locationy=e+2*Math.random()*o-o,this.locationNotTouched=1,this.soundCountdown=5e3,this.locationCountdown=1e3):void 0},e.prototype.destroy=function(){return this.state.GameState.numAliens-=1,this.sprite.destroy(),e.__super__.destroy.call(this)},e}(GameObject);var Player,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var s in e)__hasProp.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Player=function(t){function e(t,i,s){var o;e.__super__.constructor.call(this,s),o=game.input.keyboard.createCursorKeys(),this.controls={},this.controls.left=o.left,this.controls.down=o.down,this.controls.right=o.right,this.controls.up=o.up,this.controls.W=game.input.keyboard.addKey(Phaser.Keyboard.W),this.controls.A=game.input.keyboard.addKey(Phaser.Keyboard.A),this.controls.S=game.input.keyboard.addKey(Phaser.Keyboard.S),this.controls.D=game.input.keyboard.addKey(Phaser.Keyboard.D),this.bullets=10,this.WALKING_SPEED=100,this.sprite=game.add.sprite(t,i,"player"),this.sprite.scale.setTo(.5,.5),this.state.backdropPlayer.add(this.sprite),this.sprite.wrapper=this,game.physics.arcade.enable(this.sprite),this.sprite.anchor.x=.5,this.sprite.anchor.y=.75,this.sprite.physicsBody=[{x:.5,y:.7,radius:27},{x:.8,y:0,radius:3},{x:.8,y:.3,radius:3}],this.i=0,this.footstepCountdown=1500,this.gunCountdown=0,this.footstep=game.add.audio("footstep"),this.gun=game.add.audio("gunshot"),this.shadow=game.add.sprite(t-game.width,i-game.height,"shadowmask"),this.state.shadows.add(this.shadow),game.physics.arcade.enable(this.shadow),this.reload=game.add.text(650,16,"reloading",{fontSize:"32px",fill:"#FFF"}),this.reload.visible=!0,this.state.hud.add(this.reload)}return __extends(e,t),e.prototype.update=function(){var t,e,i,s,o,r,a,h,n;this._updateShadow(),t=Utils.dist(this.sprite.body.velocity,{x:0,y:0}),o=!1,n=this.state.GameObjects;for(s in n)r=n[s],"alien"===r.type&&r.alive>0&&Physics.collides(this.sprite,r.sprite)&&this.destroy(),"ammo"===r.type&&game.physics.arcade.overlap(this.sprite,r.sprite,this._collectAmmo,null,this);return this.sprite.body.acceleration.x=0,this.sprite.body.acceleration.y=0,e=0,e=this.controls.left.isDown||this.controls.A.isDown?e-1:e,e=this.controls.right.isDown||this.controls.D.isDown?e+1:e,i=0,i=this.controls.down.isDown||this.controls.S.isDown?i+1:i,i=this.controls.up.isDown||this.controls.W.isDown?i-1:i,this.sprite.body.acceleration.x=this.sprite.body.velocity.x>0?300*e:150*e,this.sprite.body.acceleration.y=this.sprite.body.velocity.y>0?300*i:150*i,0===this.sprite.body.acceleration.x&&(this.sprite.body.acceleration.x=-5*this.sprite.body.velocity.x),0===this.sprite.body.acceleration.y&&(this.sprite.body.acceleration.y=-5*this.sprite.body.velocity.y),this.i=this.i+1,e=this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x-game.input.mousePointer.x,i=this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y-game.input.mousePointer.y,this.sprite.angle=-100+180*Math.atan2(i,e)/Math.PI+15*Math.sin(this.i/100)+Math.max(170,this.gunCountdown)-170,this.sprite.bringToTop(),this._footstep(),this.gunCountdown>0&&(this.gunCountdown=this.gunCountdown-1),0===this.gunCountdown?this.reload.visible=!1:0===this.state.count%10&&(this.reload.visible=!this.reload.visible),0===this.gunCountdown&&game.input.activePointer.isDown&&this._fire(),a=this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x,h=this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y,10>a&&(this.sprite.body.x=this.sprite.body.x+10-a,this.sprite.body.velocity.x=0,this.sprite.body.acceleration.x=0),a>game.width-10&&(this.sprite.body.x=this.sprite.body.x-a+game.width-10,this.sprite.body.velocity.x=0,this.sprite.body.acceleration.x=0),10>h&&(this.sprite.body.y=this.sprite.body.y+10-h,this.sprite.body.velocity.y=0,this.sprite.body.acceleration.y=0),h>game.height-10?(this.sprite.body.y=this.sprite.body.y-h+game.height-10,this.sprite.body.velocity.y=0,this.sprite.body.acceleration.y=0):void 0},e.prototype._updateShadow=function(){return this.shadow.body.velocity.x=4*(this.sprite.x-(this.shadow.x+this.shadow.width/2)),this.shadow.body.velocity.y=4*(this.sprite.y-(this.shadow.y+this.shadow.height/2)),this.shadow.bringToTop()},e.prototype._footstep=function(){return this.footstepCountdown=this.footstepCountdown-Math.abs(this.sprite.body.velocity.x)-Math.abs(this.sprite.body.velocity.y),this.footstepCountdown<0?(this.footstepCountdown=1500,new Circle(this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x,this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y,2*Math.max(Math.abs(this.sprite.body.velocity.x),Math.abs(this.sprite.body.velocity.y)),this.state),this.footstep.play()):void 0},e.prototype._fire=function(){var t,e,i;return this.bullets>0?(this.gunCountdown=50,this.gun.play(),t=this.sprite.angle,t*=Math.PI/180,t+=Math.atan(.5*this.sprite.body.width/(.75*this.sprite.body.height)),e=Math.sqrt(Math.pow(.5*this.sprite.body.width,2)+Math.pow(.75*this.sprite.body.height,2)),i={x:this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x+e*Math.sin(t),y:this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y-e*Math.cos(t)},new Circle(i.x,i.y,2e3,this.state),new Bullet(i.x,i.y,this.sprite.angle*Math.PI/180-Math.PI/2,this.state),this.bullets-=1):void 0},e.prototype._collectAmmo=function(t,e){return e.wrapper.destroy(),this.bullets=Math.min(10,this.bullets+2)},e.prototype.destroy=function(){return e.__super__.destroy.call(this),game.state.start("game_over")},e}(GameObject);var AmmoBox,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var s in e)__hasProp.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};AmmoBox=function(t){function e(t,i,s){e.__super__.constructor.call(this,s),this.type="ammo",this.sprite=game.add.sprite(t,i,"ammo"),this.state.backdropPlayer.add(this.sprite),this.sprite.wrapper=this,game.physics.arcade.enable(this.sprite),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5}return __extends(e,t),e.prototype.update=function(){},e.prototype.destroy=function(){return this.sprite.destroy(),this.state.GameState.numAmmoBoxes-=1,e.__super__.destroy.call(this)},e}(GameObject);var Bullet,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var s in e)__hasProp.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Bullet=function(t){function e(t,i,s,o){var r;e.__super__.constructor.call(this,o),this.type="bullet",this.sprite=game.add.sprite(t,i,"bullet"),this.sprite.wrapper=this,this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.scale.setTo(.4,.4),this.sprite.tint=16777215,game.physics.arcade.enable(this.sprite),this.sprite.body.checkWorldBounds=!0,this.sprite.events.onOutOfBounds.add(this.destroy,this),this.BULLET_SPEED=1e3,r={x:this.BULLET_SPEED*Math.cos(s),y:this.BULLET_SPEED*Math.sin(s)},this.sprite.body.velocity=r}return __extends(e,t),e.prototype.update=function(){return this.sprite.bringToTop()},e.prototype.destroy=function(){return this.sprite.destroy(),e.__super__.destroy.call(this)},e}(GameObject);var Circle,__hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var s in e)__hasProp.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Circle=function(t){function e(t,i,s,o){var r,a,h;this.r=s,e.__super__.constructor.call(this,o),this.sprite=game.add.sprite(t,i,"circle"),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.width=10,this.sprite.height=10,this.r,h=o.GameObjects;for(r in h)a=h[r],"alien"===a.type&&a.hear(t,i,this.r)}return __extends(e,t),e.prototype.update=function(){var t;return t=1.06*this.sprite.width,this.sprite.width=t,this.sprite.height=t,this.sprite.alpha=.3*(1-t/this.r),this.invalid()?this.destroy():void 0},e.prototype.invalid=function(){return this.sprite.height>2*this.rad},e.prototype.destroy=function(){return this.sprite.destroy(),this.sfx.destroy(),e.__super__.destroy.call(this)},e}(GameObject);var Graph;Graph=function(){function t(t){this.nodes=t}return t}();var debugging,game;debugging=!1,game=new Phaser.Game(800,600,Phaser.AUTO,"phaser-stage"),game.state.add("menu",Menu),game.state.add("play",Play),game.state.add("game_over",GameOver),game.state.start("menu");