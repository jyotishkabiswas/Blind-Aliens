var GameObject;GameObject=function(){function t(t){this.state=t,this.isAlien=!1,this.id=Utils.uuid(),this.state.GameObjects[this.id]=this}return t.prototype.update=function(){},t.prototype.destroy=function(){return delete this.state.GameObjects[this.id]},t}();var Menu;Menu={preload:function(){return game.load.image("background","library/assets/background.png")},create:function(){var t,i;game.add.sprite(0,0,"background"),i=game.add.text(game.world.centerX,150,"Blind Aliens",{font:"65px Arial",fill:"#ffffff",align:"center"}),i.anchor.setTo(.5,.5),t=game.add.text(game.world.centerX,300,"Click anywhere to play the game",{font:"16px Arial",fill:"#bbbbbb",align:"center"}),t.anchor.setTo(.5,.5)},update:function(){game.input.activePointer.justPressed()&&game.state.start("play")}};var Play;Play=function(){function t(){}var i;return i=null,t.prototype.preload=function(){return game.load.image("shadowmask","library/assets/shadowmask.png"),game.load.image("background","library/assets/background.png"),game.load.image("side_shadows","library/assets/side_shadows.png"),game.load.image("player","library/assets/player.png"),game.load.image("circle","library/assets/circle.png"),game.load.image("bullet","library/assets/bullet.png"),game.load.spritesheet("enemy","library/assets/alien_spreadsheet_350_402.png",350,402,4),game.load.audio("footstep","library/assets/footstep.m4a"),game.load.audio("gunshot","library/assets/gunshot.wav")},t.prototype.create=function(){var i,e,s;for(this.GameState={numAliens:0},this.GameObjects={},this.sprites=game.add.group(),this.hud=game.add.group(),game.physics.startSystem(Phaser.Physics.ARCADE),this.sprites.create(0,0,"background"),e=new Player(game.width/2,game.height/2,this),i=s=1;2>=s;i=++s)this.newAlien();this.sprites.create(0,0,"side_shadows"),this.score=0,this.count=0,this.scoreboard=game.add.text(16,16,"0",{fontSize:"32px",fill:"#FFF"}),this.hud.add(this.scoreboard),t.pauseText=game.add.text(game.world.centerX,game.world.centerY,"",{font:"bold 32px Arial",fill:"#ffffff",align:"center"}),t.pauseText.anchor.setTo(.5,.5),game.input.keyboard.onDownCallback=this.pauseOrResume},t.prototype.newAlien=function(){var t,i,e;return t=2*Math.random()*(game.width+game.height),t<game.width?(i=t,e=-40):t<2*game.width?(i=t-game.width,e=40+game.height):t<2*game.width+game.height?(e=t-2*game.width,i=-40):(e=t-(2*game.width+game.height),i=40+game.width),new Alien(i,e,this),this.GameState.numAliens+=1},t.prototype.update=function(){var t,i,e,s;0===this.count%20&&(this.score=this.score+1,this.scoreboard.text=this.score.toString()),this.count=this.count+1,(this.GameState.numAliens<2&&Math.random()<.03||Math.random()<5e-4&&this.GameState.numAliens<4)&&this.newAlien(),e=this.GameObjects,s=[];for(t in e)i=e[t],s.push(i.update());return s},t.prototype.destroy=function(){return game.input.keyboard.onDownCallback=null},t.prototype.pauseOrResume=function(){"play"===game.state.current&&game.input.keyboard.justPressed(Phaser.Keyboard.SPACEBAR)&&(null==this.lastClick||game.time.now-this.lastClick>50)&&(this.lastClick=game.time.now,game.paused?(game.paused=!1,t.pauseText.text=""):(t.pauseText.text="Game Paused",game.paused=!0))},t}();var Utils;Utils={},Utils.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i,e;return i=16*Math.random()|0,e="x"===t?i:3&i|8,e.toString(16)})},Utils.dist=function(t,i){var e,s;return e=t.x-i.x,s=t.y-i.y,Math.sqrt(e*e+s*s)};var Alien,__hasProp={}.hasOwnProperty,__extends=function(t,i){function e(){this.constructor=t}for(var s in i)__hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};Alien=function(t){function i(t,e,s){var o,r;i.__super__.constructor.call(this,s),this.type="alien",this.SCORE_VALUE=200,this.sprite=game.add.sprite(t,e,"enemy"),this.state.sprites.add(this.sprite),this.sprite.wrapper=this,this.sprite.scale.setTo(.3,.3),game.physics.arcade.enable(this.sprite),this.sprite.animations.add("crawl"),this.crawl=this.sprite.play("crawl",8,!0),this.sprite.anchor.setTo(.5,.5),this.sprite.alpha=1,this.alive=2,this.stunCountdown=0,o=200+Math.random()*(game.width-400),r=200+Math.random()*(game.height-400),t=this.sprite.body.x+this.sprite.width/2,e=this.sprite.body.y+this.sprite.height/2,this.sprite.angle=180/Math.PI*Math.atan2(o-t,-(r-e)),this.soundCountdown=0,this.moveCountdown=0,this.dtheta=0,this.dr=0,this.returnQuantity=10,this.locationNotTouched=0,this.locationx=0,this.locationy=0}return __extends(i,t),i.prototype.update=function(){var t,i,e,s,o;if(this.sprite.bringToTop(),e=this.sprite.body.x+this.sprite.width/2,s=this.sprite.body.y+this.sprite.height/2,(-100>e||-100>s||e>game.width+100||s>game.height+100)&&this.destroy(),this.alive>0){o=this.state.GameObjects;for(t in o)i=o[t],"bullet"===i.type&&game.physics.arcade.collide(this.sprite,i.sprite,null,this._hitByBullet,this);if(this.sprite.body.velocity.x*=.97,this.sprite.body.velocity.y*=.97,this.moveCountdown>0&&(this.moveCountdown=this.moveCountdown-1),this.soundCountdown>0&&(this.soundCountdown=this.soundCountdown-1),!(this.stunCountdown>0))return this._walk();if(this.stunCountdown=this.stunCountdown-1,this.stunCountdown<=0)return this.crawl.isPaused=!1}else if(this.sprite.body.acceleration.x=0,this.sprite.body.acceleration.y=0,this.sprite.body.velocity.x*=.97,this.sprite.body.velocity.y*=.97,this.sprite.alpha=this.sprite.alpha-.01,this.crawl.isPaused=!0,this.sprite.alpha<=0)return this.destroy()},i.prototype._hitByBullet=function(t,i){return t.wrapper.state.score=t.wrapper.state.score+t.wrapper.SCORE_VALUE/2,t.wrapper.crawl.isPaused=!0,t.wrapper.stunCountdown=60,t.wrapper.alive=t.wrapper.alive-1,t.tint=21760,t.body.velocity.x+=i.body.velocity.x/5,t.body.velocity.y+=i.body.velocity.y/5,t.body.acceleration.x=0,t.body.acceleration.y=0,i.wrapper.destroy(),!1},i.prototype._walk=function(){var t,i,e,s,o,r,a;return this.moveCountdown>0?(this.sprite.angle+=this.dtheta,o=Math.sin(this.sprite.angle*Math.PI/180),a=Math.cos(this.sprite.angle*Math.PI/180),e=2===this.alive?2:1.7,this.sprite.body.velocity.x=this.dr*o*100*this.alive,this.sprite.body.velocity.y=-this.dr*a*100*this.alive):(this.sprite.body.acceleration.x=0,this.sprite.body.acceleration.y=0,this.moveCountdown=20*Math.random()+15,this.dtheta=Math.random()>.33?4*Math.random()-2:0,this.dr=0===this.dtheta?.8+.2*Math.random():0,s=this.sprite.body.x+this.sprite.width/2,r=this.sprite.body.y+this.sprite.height/2,(0>s||0>r||s>game.width||r>game.height)&&(this.returnQuantity>0||this.soundCountdown>0)&&(this.returnQuantity+=0===this.soundCountdown?-1:1,this.returnQuantity%2===1?(t=200+Math.random()*(game.width-400),i=200+Math.random()*(game.height-400),this._target(t,i)):(this.dtheta=0,this.dr=.8+.2*Math.random())),1===this.locationNotTouched?(this._target(this.locationx,this.locationy),this.dr=this.moveCountdown<70?1:.5,this.dtheta*=2,this.moveCountdown=5,(s-this.locationx)*(s-this.locationx)+(r-this.locationy)*(r-this.locationy)<=1e4&&(this.locationNotTouched=0),this.soundCountdown=this.soundCountdown+1):void 0)},i.prototype._target=function(t,i){var e,s,o;return s=this.sprite.body.x+this.sprite.width/2,o=this.sprite.body.y+this.sprite.height/2,this.dtheta=1,this.dr=0,e=180/Math.PI*Math.atan2(t-s,-(i-o)),this.moveCountdown=(e-this.sprite.angle+360)%360,this.moveCountdown>180&&(this.dtheta=-1),this.moveCountdown>180?this.moveCountdown=360-this.moveCountdown:void 0},i.prototype.hear=function(t,i,e){var s,o,r,a;return r=this.sprite.body.x+this.sprite.width/2,a=this.sprite.body.y+this.sprite.height/2,s=(r-t)*(r-t)+(a-i)*(a-i),e*e>=s?(o=Math.sqrt(s)/10,this.locationx=t+2*Math.random()*o-o,this.locationy=i+2*Math.random()*o-o,this.locationNotTouched=1,this.soundCountdown=5e3):void 0},i.prototype.destroy=function(){return this.state.GameState.numAliens-=1,this.sprite.destroy(),i.__super__.destroy.call(this)},i}(GameObject);var Player,__hasProp={}.hasOwnProperty,__extends=function(t,i){function e(){this.constructor=t}for(var s in i)__hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};Player=function(t){function i(t,e,s){var o;i.__super__.constructor.call(this,s),o=game.input.keyboard.createCursorKeys(),this.controls={},this.controls.left=o.left,this.controls.down=o.down,this.controls.right=o.right,this.controls.up=o.up,this.controls.W=game.input.keyboard.addKey(Phaser.Keyboard.W),this.controls.A=game.input.keyboard.addKey(Phaser.Keyboard.A),this.controls.S=game.input.keyboard.addKey(Phaser.Keyboard.S),this.controls.D=game.input.keyboard.addKey(Phaser.Keyboard.D),this.WALKING_SPEED=100,this.sprite=game.add.sprite(t,e,"player"),this.state.sprites.add(this.sprite),this.sprite.wrapper=this,game.physics.arcade.enable(this.sprite),this.sprite.anchor.x=.5,this.sprite.anchor.y=.75,this.i=0,this.footstepCountdown=3e3,this.gunCountdown=0,this.footstep=game.add.audio("footstep"),this.gun=game.add.audio("gunshot"),this.shadow=game.add.sprite(t-game.width,e-game.height,"shadowmask"),this.state.sprites.add(this.shadow),game.physics.arcade.enable(this.shadow),this.reload=game.add.text(650,16,"reloading",{fontSize:"32px",fill:"#FFF"}),this.reload.visible=!0,this.state.hud.add(this.reload)}return __extends(i,t),i.prototype.update=function(){var t,i,e,s,o,r,a,h,n,d;this._updateShadow(),t=Utils.dist(this.sprite.body.velocity,{x:0,y:0}),r=!1,d=this.state.GameObjects;for(o in d)a=d[o],"alien"===a.type&&(i=Math.sqrt(Math.pow(this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x-a.sprite.body.x-.5*a.sprite.body.width,2)+Math.pow(this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y-a.sprite.body.y-.5*a.sprite.body.height,2)),70>i&&a.alive>0&&this.destroy());return this.sprite.body.acceleration.x=0,this.sprite.body.acceleration.y=0,e=0,e=this.controls.left.isDown||this.controls.A.isDown?e-1:e,e=this.controls.right.isDown||this.controls.D.isDown?e+1:e,s=0,s=this.controls.down.isDown||this.controls.S.isDown?s+1:s,s=this.controls.up.isDown||this.controls.W.isDown?s-1:s,this.sprite.body.acceleration.x=this.sprite.body.velocity.x>0?600*e:300*e,this.sprite.body.acceleration.y=this.sprite.body.velocity.y>0?600*s:300*s,0===this.sprite.body.acceleration.x&&(this.sprite.body.acceleration.x=-5*this.sprite.body.velocity.x),0===this.sprite.body.acceleration.y&&(this.sprite.body.acceleration.y=-5*this.sprite.body.velocity.y),this.i=this.i+1,e=this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x-game.input.mousePointer.x,s=this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y-game.input.mousePointer.y,this.sprite.angle=-100+180*Math.atan2(s,e)/Math.PI+15*Math.sin(this.i/100)+Math.max(170,this.gunCountdown)-170,this.sprite.bringToTop(),this._footstep(),this.gunCountdown>0&&(this.gunCountdown=this.gunCountdown-1),0===this.gunCountdown?this.reload.visible=!1:0===this.state.count%20&&(this.reload.visible=!this.reload.visible),0===this.gunCountdown&&game.input.activePointer.isDown&&this._fire(),h=this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x,n=this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y,20>h&&(this.sprite.body.x=this.sprite.body.x+20-h,this.sprite.body.velocity.x=0,this.sprite.body.acceleration.x=0),h>game.width-20&&(this.sprite.body.x=this.sprite.body.x-h+game.width-20,this.sprite.body.velocity.x=0,this.sprite.body.acceleration.x=0),20>n&&(this.sprite.body.y=this.sprite.body.y+20-n,this.sprite.body.velocity.y=0,this.sprite.body.acceleration.y=0),n>game.height-20?(this.sprite.body.y=this.sprite.body.y-n+game.height-20,this.sprite.body.velocity.y=0,this.sprite.body.acceleration.y=0):void 0},i.prototype._updateShadow=function(){return this.shadow.body.velocity.x=4*(this.sprite.x-(this.shadow.x+this.shadow.width/2)),this.shadow.body.velocity.y=4*(this.sprite.y-(this.shadow.y+this.shadow.height/2)),this.shadow.bringToTop()},i.prototype._footstep=function(){return this.footstepCountdown=this.footstepCountdown-Math.abs(this.sprite.body.velocity.x)-Math.abs(this.sprite.body.velocity.y),this.footstepCountdown<0?(this.footstepCountdown=3e3,new Circle(this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x,this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y,2*Math.max(Math.abs(this.sprite.body.velocity.x),Math.abs(this.sprite.body.velocity.y)),this.state),this.footstep.play()):void 0},i.prototype._fire=function(){var t,i,e;return this.gunCountdown=200,this.gun.play(),t=this.sprite.angle,t*=Math.PI/180,t+=Math.atan(.5*this.sprite.body.width/(.75*this.sprite.body.height)),i=Math.sqrt(Math.pow(.5*this.sprite.body.width,2)+Math.pow(.75*this.sprite.body.height,2)),e={x:this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x+i*Math.sin(t),y:this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y-i*Math.cos(t)},new Circle(e.x,e.y,2e3,this.state),new Bullet(e.x,e.y,this.sprite.angle*Math.PI/180-Math.PI/2,this.state)},i.prototype.destroy=function(){return i.__super__.destroy.call(this),game.state.start("menu")},i}(GameObject);var Bullet,__hasProp={}.hasOwnProperty,__extends=function(t,i){function e(){this.constructor=t}for(var s in i)__hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};Bullet=function(t){function i(t,e,s,o){var r;i.__super__.constructor.call(this,o),this.type="bullet",this.sprite=game.add.sprite(t,e,"bullet"),this.sprite.wrapper=this,this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,game.physics.arcade.enable(this.sprite),this.sprite.body.checkWorldBounds=!0,this.sprite.events.onOutOfBounds.add(this.destroy,this),this.BULLET_SPEED=1e3,r={x:this.BULLET_SPEED*Math.cos(s),y:this.BULLET_SPEED*Math.sin(s)},this.sprite.body.velocity=r}return __extends(i,t),i.prototype.update=function(){return this.sprite.bringToTop()},i.prototype.destroy=function(){return this.sprite.destroy(),i.__super__.destroy.call(this)},i}(GameObject);var Circle,__hasProp={}.hasOwnProperty,__extends=function(t,i){function e(){this.constructor=t}for(var s in i)__hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};Circle=function(t){function i(t,e,s,o){var r,a,h;this.r=s,i.__super__.constructor.call(this,o),this.sprite=game.add.sprite(t,e,"circle"),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.width=10,this.sprite.height=10,this.r,h=o.GameObjects;for(r in h)a=h[r],"alien"===a.type&&a.hear(t,e,this.r)}return __extends(i,t),i.prototype.update=function(){var t;return t=1.06*this.sprite.width,this.sprite.width=t,this.sprite.height=t,this.sprite.alpha=.3*(1-t/this.r),this.invalid()?this.destroy():void 0},i.prototype.invalid=function(){return this.sprite.height>2*this.rad},i.prototype.destroy=function(){return this.sprite.destroy(),this.sfx.destroy(),i.__super__.destroy.call(this)},i}(GameObject);var Graph;Graph=function(){function t(t){this.nodes=t}return t}();var game;game=new Phaser.Game(800,600,Phaser.AUTO,"phaser-stage"),game.state.add("menu",Menu),game.state.add("play",Play),game.state.start("menu");