var GameObject,GameObjects,GameState;GameObjects={},GameState={},GameObject=function(){function t(){this.isAlien=!1,this.id=Utils.uuid(),GameObjects[this.id]=this}return t.prototype.update=function(){},t.prototype.destroy=function(){return delete GameObjects[this.id]},t}();var Menu;Menu={preload:function(){return game.load.image("background","library/assets/background.png")},create:function(){var t,i;game.add.sprite(0,0,"background"),i=game.add.text(game.world.centerX,150,"Blind Aliens",{font:"65px Arial",fill:"#ffffff",align:"center"}),i.anchor.setTo(.5,.5),t=game.add.text(game.world.centerX,300,"Click anywhere to play the game",{font:"16px Arial",fill:"#bbbbbb",align:"center"}),t.anchor.setTo(.5,.5)},update:function(){game.input.activePointer.justPressed()&&game.state.start("play")}};var Play;Play=function(){function t(){}return t.prototype.preload=function(){return game.load.image("background","library/assets/background.png"),game.load.image("player","library/assets/player.png"),game.load.image("circle","library/assets/circle.png"),game.load.audio("footstep","library/assets/footstep.wav"),game.load.audio("gunshot","library/assets/gunshot.wav")},t.prototype.create=function(){var t,i,e,s,r;for(GameState.playerLocation=null,game.physics.startSystem(Phaser.Physics.ARCADE),game.add.sprite(0,0,"background"),e=new Player(50,50),r=[],i=s=1;3>=s;i=++s)r.push(t=new Alien(150*i,500));return r},t.prototype.update=function(){var t,i,e;e=[];for(t in GameObjects)i=GameObjects[t],e.push(i.update());return e},t}();var Utils;Utils={},Utils.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i,e;return i=16*Math.random()|0,e="x"===t?i:3&i|8,e.toString(16)})},Utils.dist=function(t,i){var e,s;return e=t.x-i.x,s=t.y-i.y,Math.sqrt(e*e+s*s)};var Alien,__hasProp={}.hasOwnProperty,__extends=function(t,i){function e(){this.constructor=t}for(var s in i)__hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};Alien=function(t){function i(t,e){i.__super__.constructor.call(this),this.type="alien",this.MAX_SPEED=200,this.MAX_ACCELERATION=500,this.state=this.constructor.STATES.UNAWARE,this.sprite=game.add.sprite(t,e,"circle"),this.sprite.scale.setTo(.3,.3),game.physics.arcade.enable(this.sprite),this.sprite.body.collideWorldBounds=!0,this.sprite.anchor.setTo(.5,.5),this.state=this.constructor.STATES.UNAWARE}return __extends(i,t),i.STATES={UNAWARE:"WAITING",AWARE:{x:0,y:0}},i.prototype.update=function(){var t,i;this.sprite.bringToTop();for(t in GameObjects)i=GameObjects[t],"bullet"===i.type?game.physics.arcade.collide(this.sprite,i.sprite,this._hitByBullet,null,this):game.physics.arcade.collide(this.sprite,i.sprite);return this.state=null!=GameState.playerLocation?GameState.playerLocation:this.constructor.STATES.UNAWARE,this.state===this.constructor.STATES.UNAWARE?this._randomWalk():this._awareWalk()},i.prototype._hitByBullet=function(t,i){return t.destroy(),i.destroy()},i.prototype._randomWalk=function(){var t;return t=2*Math.random()*Math.PI,this.sprite.body.acceleration.x=.5*this.MAX_ACCELERATION*Math.cos(t),this.sprite.body.acceleration.y=.5*this.MAX_ACCELERATION*Math.sin(t)},i.prototype._awareWalk=function(){var t,i,e,s;return i=Utils.dist(this.sprite.position,this.state),i<this.sprite.width?(GameState.playerLocation=null,void 0):(e=this.state.x-this.sprite.body.position.x,s=this.state.y-this.sprite.body.position.y,t=(e*e+s*s)/(this.MAX_SPEED*this.MAX_SPEED),this.sprite.body.velocity.x=this.MAX_SPEED*e/i,this.sprite.body.velocity.y=this.MAX_SPEED*s/i)},i.prototype.destroy=function(){return this.sprite.destroy(),i.__super__.destroy.call(this)},i}(GameObject);var Circle,__hasProp={}.hasOwnProperty,__extends=function(t,i){function e(){this.constructor=t}for(var s in i)__hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};Circle=function(t){function i(t,e,s){this.x=t,this.y=e,this.r=s,i.__super__.constructor.call(this),this.sprite=game.add.sprite(this.x,this.y,"circle"),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.width=10,this.sprite.height=10,this.rad=this.r,this.sfx=game.add.audio("footstep"),this.sfx.play()}return __extends(i,t),i.prototype.update=function(){var t;return t=3+this.sprite.width,this.sprite.width=t,this.sprite.height=t,this.sprite.alpha=1-t/this.rad,this.invalid()?this.destroy():void 0},i.prototype.invalid=function(){return this.sprite.height>2*this.rad},i.prototype.destroy=function(){return this.sprite.destroy(),this.sfx.destroy(),i.__super__.destroy.call(this)},i}(GameObject);var Player,__hasProp={}.hasOwnProperty,__extends=function(t,i){function e(){this.constructor=t}for(var s in i)__hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};Player=function(t){function i(t,e){var s;i.__super__.constructor.call(this),s=game.input.keyboard.createCursorKeys(),this.controls={},this.controls.left=s.left,this.controls.down=s.down,this.controls.right=s.right,this.controls.up=s.up,this.controls.W=game.input.keyboard.addKey(Phaser.Keyboard.W),this.controls.A=game.input.keyboard.addKey(Phaser.Keyboard.A),this.controls.S=game.input.keyboard.addKey(Phaser.Keyboard.S),this.controls.D=game.input.keyboard.addKey(Phaser.Keyboard.D),this.WALKING_SPEED=100,this.sprite=game.add.sprite(t,e,"player"),game.physics.arcade.enable(this.sprite),this.sprite.body.collideWorldBounds=!0,this.sprite.anchor.x=.5,this.sprite.anchor.y=.75,this.i=0,this.footstepCountdown=3e3,this.gunCountdown=0}return __extends(i,t),i.prototype.update=function(){var t,i,e,s,r,o,a,n,h;t=Utils.dist(this.sprite.body.velocity,{x:0,y:0}),o=!1;for(r in GameObjects)a=GameObjects[r],"alien"===a.type&&(game.physics.arcade.collide(this.sprite,a.sprite,this.destroy,null,this),i=Utils.dist(a.sprite.body.position,this.sprite.body.position),t-this.WALKING_SPEED>=i/2&&(o=!0));return o&&(GameState.playerLocation={x:this.sprite.body.position.x,y:this.sprite.body.position.y}),this.sprite.body.acceleration.x=0,this.sprite.body.acceleration.y=0,e=0,e=this.controls.left.isDown||this.controls.A.isDown?e-1:e,e=this.controls.right.isDown||this.controls.D.isDown?e+1:e,s=0,s=this.controls.down.isDown||this.controls.S.isDown?s+1:s,s=this.controls.up.isDown||this.controls.W.isDown?s-1:s,this.sprite.body.acceleration.x=this.sprite.body.velocity.x>0?600*e:300*e,this.sprite.body.acceleration.y=this.sprite.body.velocity.y>0?600*s:300*s,0===this.sprite.body.acceleration.x&&(this.sprite.body.acceleration.x=-5*this.sprite.body.velocity.x),0===this.sprite.body.acceleration.y&&(this.sprite.body.acceleration.y=-5*this.sprite.body.velocity.y),this.i=this.i+1,e=this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x-game.input.mousePointer.x,s=this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y-game.input.mousePointer.y,this.sprite.angle=-100+180*Math.atan2(s,e)/Math.PI+15*Math.sin(this.i/100),this.sprite.bringToTop(),this._footstep(),this.gunCountdown>0&&(this.gunCountdown=this.gunCountdown-1),0===this.gunCountdown&&game.input.activePointer.isDown&&this._fire(),n=this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x,h=this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y,20>n&&(this.sprite.body.x=this.sprite.body.x+20-n,this.sprite.body.velocity.x=0,this.sprite.body.acceleration.x=0),n>game.width-20&&(this.sprite.body.x=this.sprite.body.x-n+game.width-20,this.sprite.body.velocity.x=0,this.sprite.body.acceleration.x=0),20>h&&(this.sprite.body.y=this.sprite.body.y+20-h,this.sprite.body.velocity.y=0,this.sprite.body.acceleration.y=0),h>game.height-20?(this.sprite.body.y=this.sprite.body.y-h+game.height-20,this.sprite.body.velocity.y=0,this.sprite.body.acceleration.y=0):void 0},i.prototype._footstep=function(){return this.footstepCountdown=this.footstepCountdown-Math.abs(this.sprite.body.velocity.x)-Math.abs(this.sprite.body.velocity.y),this.footstepCountdown<0?(this.footstepCountdown=3e3,new Circle(this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x,this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y,2*Math.max(Math.abs(this.sprite.body.velocity.x),Math.abs(this.sprite.body.velocity.y)))):void 0},i.prototype._fire=function(){var t,i,e,s,r,o;return this.gunCountdown=250,t=this.sprite.angle,t*=Math.PI/180,t+=Math.atan(.5*this.sprite.body.width/(.75*this.sprite.body.height)),s=Math.sqrt(Math.pow(.5*this.sprite.body.width,2)+Math.pow(.75*this.sprite.body.height,2)),o={x:this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x+s*Math.sin(t),y:this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y-s*Math.cos(t)},e=this.sprite.angle+60*(Math.random()-.5),console.log(this.sprite.angle,e),r=new Circle(o.x,o.y,2e3),this.sprite.angle=e,i=new Bullet(o.x,o.y,e*Math.PI/180-Math.PI/2),GameState.playerLocation={x:o.x,y:o.y}},i.prototype.destroy=function(){return i.__super__.destroy.call(this),game.state.start("menu")},i}(GameObject);var Bullet,__hasProp={}.hasOwnProperty,__extends=function(t,i){function e(){this.constructor=t}for(var s in i)__hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};Bullet=function(t){function i(t,e,s){var r;i.__super__.constructor.call(this),this.type="bullet",this.sprite=game.add.sprite(t,e,"circle"),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.scale.setTo(.03,.03),game.physics.arcade.enable(this.sprite),this.sprite.body.checkWorldBounds=!0,this.sprite.events.onOutOfBounds.add(this.destroy,this),this.BULLET_SPEED=1e3,r={x:this.BULLET_SPEED*Math.cos(s),y:this.BULLET_SPEED*Math.sin(s)},this.sprite.body.velocity=r,this.sfx=game.add.audio("gunshot"),this.sfx.play()}return __extends(i,t),i.prototype.update=function(){return this.sprite.bringToTop()},i.prototype.destroy=function(){return this.sprite.destroy(),this.sfx.destroy(),i.__super__.destroy.call(this)},i}(GameObject);var Circle,__hasProp={}.hasOwnProperty,__extends=function(t,i){function e(){this.constructor=t}for(var s in i)__hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};Circle=function(t){function i(t,e,s){this.x=t,this.y=e,this.r=s,i.__super__.constructor.call(this),this.sprite=game.add.sprite(this.x,this.y,"circle"),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.width=10,this.sprite.height=10,this.rad=this.r,this.sfx=game.add.audio("footstep"),this.sfx.play()}return __extends(i,t),i.prototype.update=function(){var t;return t=3+this.sprite.width,this.sprite.width=t,this.sprite.height=t,this.sprite.alpha=1-t/this.rad,this.invalid()?this.destroy():void 0},i.prototype.invalid=function(){return this.sprite.height>2*this.rad},i.prototype.destroy=function(){return this.sprite.destroy(),this.sfx.destroy(),i.__super__.destroy.call(this)},i}(GameObject);var Graph;Graph=function(){function t(t){this.nodes=t}return t}();var game;game=new Phaser.Game(800,600,Phaser.AUTO,"phaser-stage"),game.state.add("menu",Menu),game.state.add("play",Play),game.state.start("menu");