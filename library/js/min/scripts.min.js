var GameObject;GameObject=function(){function t(t){this.state=t,this.isAlien=!1,this.id=Utils.uuid(),this.state.GameObjects[this.id]=this}return t.prototype.update=function(){},t.prototype.destroy=function(){return delete this.state.GameObjects[this.id]},t}();var Menu;Menu={preload:function(){return game.load.image("background","library/assets/background.png")},create:function(){var t,s;game.add.sprite(0,0,"background"),s=game.add.text(game.world.centerX,150,"Blind Aliens",{font:"65px Arial",fill:"#ffffff",align:"center"}),s.anchor.setTo(.5,.5),t=game.add.text(game.world.centerX,300,"Click anywhere to play the game",{font:"16px Arial",fill:"#bbbbbb",align:"center"}),t.anchor.setTo(.5,.5)},update:function(){game.input.activePointer.justPressed()&&game.state.start("play")}};var Play;Play=function(){function t(){}return t.prototype.preload=function(){return game.load.image("shadowmask","library/assets/shadowmask.png"),game.load.image("background","library/assets/background.png"),game.load.image("player","library/assets/player.png"),game.load.image("circle","library/assets/circle.png"),game.load.image("enemy","library/assets/alien.png"),game.load.audio("footstep","library/assets/footstep.m4a"),game.load.audio("gunshot","library/assets/gunshot.wav")},t.prototype.create=function(){var t,s,i,e,r;for(this.GameState={playerLocation:null,numAliens:3},this.GameObjects={},game.physics.startSystem(Phaser.Physics.ARCADE),game.add.sprite(0,0,"background"),i=new Player(50,50,this),r=[],s=e=1;3>=e;s=++e)r.push(t=new Alien(150*s,500,this));return r},t.prototype.update=function(){var t,s,i,e;i=this.GameObjects,e=[];for(t in i)s=i[t],e.push(s.update());return e},t}();var Utils;Utils={},Utils.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var s,i;return s=16*Math.random()|0,i="x"===t?s:3&s|8,i.toString(16)})},Utils.dist=function(t,s){var i,e;return i=t.x-s.x,e=t.y-s.y,Math.sqrt(i*i+e*e)};var Alien,__hasProp={}.hasOwnProperty,__extends=function(t,s){function i(){this.constructor=t}for(var e in s)__hasProp.call(s,e)&&(t[e]=s[e]);return i.prototype=s.prototype,t.prototype=new i,t.__super__=s.prototype,t};Alien=function(t){function s(t,i,e){s.__super__.constructor.call(this,e),this.type="alien",this.MAX_SPEED=200,this.MAX_ACCELERATION=500,this.sprite=game.add.sprite(t,i,"enemy"),this.sprite.wrapper=this,this.sprite.scale.setTo(.3,.3),game.physics.arcade.enable(this.sprite),this.sprite.body.collideWorldBounds=!0,this.sprite.anchor.setTo(.5,.5)}return __extends(s,t),s.prototype.update=function(){var t,s,i;this.sprite.bringToTop(),i=this.state.GameObjects;for(t in i)s=i[t],"bullet"===s.type?game.physics.arcade.collide(this.sprite,s.sprite,this._hitByBullet,null,this):game.physics.arcade.collide(this.sprite,s.sprite);return null!=this.state.GameState.playerLocation?this._awareWalk():this._randomWalk()},s.prototype._hitByBullet=function(t,s){return t.wrapper.destroy(),s.wrapper.destroy()},s.prototype._randomWalk=function(){var t;return t=2*Math.random()*Math.PI,this.sprite.body.acceleration.x=.5*this.MAX_ACCELERATION*Math.cos(t),this.sprite.body.acceleration.y=.5*this.MAX_ACCELERATION*Math.sin(t)},s.prototype._awareWalk=function(){var t,s,i,e;return t=this.state.GameState.playerLocation,s=Utils.dist(this.sprite.position,t),s<this.sprite.width&&(this.state.GameState.playerLocation=null,this._randomWalk()),i=t.x-this.sprite.body.position.x,e=t.y-this.sprite.body.position.y,this.sprite.body.velocity.x=this.MAX_SPEED*i/s,this.sprite.body.velocity.y=this.MAX_SPEED*e/s},s.prototype.destroy=function(){return this.state.GameState.numAliens-=1,this.sprite.destroy(),s.__super__.destroy.call(this),0===this.state.GameState.numAliens?game.state.start("menu"):void 0},s}(GameObject);var Circle,__hasProp={}.hasOwnProperty,__extends=function(t,s){function i(){this.constructor=t}for(var e in s)__hasProp.call(s,e)&&(t[e]=s[e]);return i.prototype=s.prototype,t.prototype=new i,t.__super__=s.prototype,t};Circle=function(t){function s(t,i,e){this.x=t,this.y=i,this.r=e,s.__super__.constructor.call(this),this.sprite=game.add.sprite(this.x,this.y,"circle"),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.width=10,this.sprite.height=10,this.rad=this.r,this.sfx=game.add.audio("footstep"),this.sfx.play()}return __extends(s,t),s.prototype.update=function(){var t;return t=3+this.sprite.width,this.sprite.width=t,this.sprite.height=t,this.sprite.alpha=1-t/this.rad,this.invalid()?this.destroy():void 0},s.prototype.invalid=function(){return this.sprite.height>2*this.rad},s.prototype.destroy=function(){return this.sprite.destroy(),this.sfx.destroy(),s.__super__.destroy.call(this)},s}(GameObject);var Player,__hasProp={}.hasOwnProperty,__extends=function(t,s){function i(){this.constructor=t}for(var e in s)__hasProp.call(s,e)&&(t[e]=s[e]);return i.prototype=s.prototype,t.prototype=new i,t.__super__=s.prototype,t};Player=function(t){function s(t,i,e){var r;s.__super__.constructor.call(this,e),r=game.input.keyboard.createCursorKeys(),this.controls={},this.controls.left=r.left,this.controls.down=r.down,this.controls.right=r.right,this.controls.up=r.up,this.controls.W=game.input.keyboard.addKey(Phaser.Keyboard.W),this.controls.A=game.input.keyboard.addKey(Phaser.Keyboard.A),this.controls.S=game.input.keyboard.addKey(Phaser.Keyboard.S),this.controls.D=game.input.keyboard.addKey(Phaser.Keyboard.D),this.WALKING_SPEED=100,this.sprite=game.add.sprite(t,i,"player"),this.sprite.wrapper=this,game.physics.arcade.enable(this.sprite),this.sprite.body.collideWorldBounds=!0,this.sprite.anchor.x=.5,this.sprite.anchor.y=.75,this.i=0,this.footstepCountdown=3e3,this.gunCountdown=0,this.shadow=game.add.sprite(t-game.width,i-game.height,"shadowmask")}return __extends(s,t),s.prototype.update=function(){var t,s,i,e,r,o,a,h,n,p;this.shadow.x=this.sprite.x-800,this.shadow.y=this.sprite.y-600,this.shadow.bringToTop(),t=Utils.dist(this.sprite.body.velocity,{x:0,y:0}),o=!1,p=this.state.GameObjects;for(r in p)a=p[r],"alien"===a.type&&(game.physics.arcade.collide(this.sprite,a.sprite,this.destroy,null,this),s=Utils.dist(a.sprite.body.position,this.sprite.body.position),t-this.WALKING_SPEED>=s/2&&(o=!0));return o&&(this.state.GameState.playerLocation={x:this.sprite.body.position.x,y:this.sprite.body.position.y}),this.sprite.body.acceleration.x=0,this.sprite.body.acceleration.y=0,i=0,i=this.controls.left.isDown||this.controls.A.isDown?i-1:i,i=this.controls.right.isDown||this.controls.D.isDown?i+1:i,e=0,e=this.controls.down.isDown||this.controls.S.isDown?e+1:e,e=this.controls.up.isDown||this.controls.W.isDown?e-1:e,this.sprite.body.acceleration.x=this.sprite.body.velocity.x>0?600*i:300*i,this.sprite.body.acceleration.y=this.sprite.body.velocity.y>0?600*e:300*e,0===this.sprite.body.acceleration.x&&(this.sprite.body.acceleration.x=-5*this.sprite.body.velocity.x),0===this.sprite.body.acceleration.y&&(this.sprite.body.acceleration.y=-5*this.sprite.body.velocity.y),this.i=this.i+1,i=this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x-game.input.mousePointer.x,e=this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y-game.input.mousePointer.y,this.sprite.angle=-100+180*Math.atan2(e,i)/Math.PI+15*Math.sin(this.i/100),this.sprite.bringToTop(),this._footstep(),this.gunCountdown>0&&(this.gunCountdown=this.gunCountdown-1),0===this.gunCountdown&&game.input.activePointer.isDown&&this._fire(),h=this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x,n=this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y,20>h&&(this.sprite.body.x=this.sprite.body.x+20-h,this.sprite.body.velocity.x=0,this.sprite.body.acceleration.x=0),h>game.width-20&&(this.sprite.body.x=this.sprite.body.x-h+game.width-20,this.sprite.body.velocity.x=0,this.sprite.body.acceleration.x=0),20>n&&(this.sprite.body.y=this.sprite.body.y+20-n,this.sprite.body.velocity.y=0,this.sprite.body.acceleration.y=0),n>game.height-20?(this.sprite.body.y=this.sprite.body.y-n+game.height-20,this.sprite.body.velocity.y=0,this.sprite.body.acceleration.y=0):void 0},s.prototype._footstep=function(){return this.footstepCountdown=this.footstepCountdown-Math.abs(this.sprite.body.velocity.x)-Math.abs(this.sprite.body.velocity.y),this.footstepCountdown<0?(this.footstepCountdown=3e3,new Circle(this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x,this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y,2*Math.max(Math.abs(this.sprite.body.velocity.x),Math.abs(this.sprite.body.velocity.y)),this.state)):void 0},s.prototype._fire=function(){var t,s,i;return this.gunCountdown=200,t=this.sprite.angle,t*=Math.PI/180,t+=Math.atan(.5*this.sprite.body.width/(.75*this.sprite.body.height)),s=Math.sqrt(Math.pow(.5*this.sprite.body.width,2)+Math.pow(.75*this.sprite.body.height,2)),i={x:this.sprite.body.x+this.sprite.body.width*this.sprite.anchor.x+s*Math.sin(t),y:this.sprite.body.y+this.sprite.body.height*this.sprite.anchor.y-s*Math.cos(t)},new Circle(i.x,i.y,2e3,this.state),new Bullet(i.x,i.y,this.sprite.angle*Math.PI/180-Math.PI/2,this.state),this.state.GameState.playerLocation={x:this.sprite.body.x,y:this.sprite.body.y}},s.prototype.destroy=function(){return s.__super__.destroy.call(this),game.state.start("menu")},s}(GameObject);var ShadowMask,__hasProp={}.hasOwnProperty,__extends=function(t,s){function i(){this.constructor=t}for(var e in s)__hasProp.call(s,e)&&(t[e]=s[e]);return i.prototype=s.prototype,t.prototype=new i,t.__super__=s.prototype,t};ShadowMask=function(t){function s(t,i){s.__super__.constructor.call(this,i),this.type="shadow",this.player=t,this.x=this.player.x-800,this.y=this.player.y-600,this.sprite=game.add.sprite(this.x,this.y,"shadowmask")}return __extends(s,t),s.prototype.update=function(){return this.sprite.x=this.player.sprite.x-800,this.sprite.y=this.player.sprite.y-600},s}(GameObject);var Bullet,__hasProp={}.hasOwnProperty,__extends=function(t,s){function i(){this.constructor=t}for(var e in s)__hasProp.call(s,e)&&(t[e]=s[e]);return i.prototype=s.prototype,t.prototype=new i,t.__super__=s.prototype,t};Bullet=function(t){function s(t,i,e,r){var o;s.__super__.constructor.call(this,r),this.type="bullet",this.sprite=game.add.sprite(t,i,"circle"),this.sprite.wrapper=this,this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.scale.setTo(.03,.03),game.physics.arcade.enable(this.sprite),this.sprite.body.checkWorldBounds=!0,this.sprite.events.onOutOfBounds.add(this.destroy,this),this.BULLET_SPEED=1e3,o={x:this.BULLET_SPEED*Math.cos(e),y:this.BULLET_SPEED*Math.sin(e)},this.sprite.body.velocity=o,this.sfx=game.add.audio("gunshot"),this.sfx.play()}return __extends(s,t),s.prototype.update=function(){return this.sprite.bringToTop()},s.prototype.destroy=function(){return this.sprite.destroy(),this.sfx.destroy(),s.__super__.destroy.call(this)},s}(GameObject);var Circle,__hasProp={}.hasOwnProperty,__extends=function(t,s){function i(){this.constructor=t}for(var e in s)__hasProp.call(s,e)&&(t[e]=s[e]);return i.prototype=s.prototype,t.prototype=new i,t.__super__=s.prototype,t};Circle=function(t){function s(t,i,e,r){this.r=e,s.__super__.constructor.call(this,r),this.sprite=game.add.sprite(t,i,"circle"),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.width=10,this.sprite.height=10,this.r,this.sfx=game.add.audio("footstep"),this.sfx.play()}return __extends(s,t),s.prototype.update=function(){var t;return t=5+this.sprite.width,this.sprite.width=t,this.sprite.height=t,this.sprite.alpha=.3*(1-t/this.r),this.invalid()?this.destroy():void 0},s.prototype.invalid=function(){return this.sprite.height>2*this.rad},s.prototype.destroy=function(){return this.sprite.destroy(),this.sfx.destroy(),s.__super__.destroy.call(this)},s}(GameObject);var Graph;Graph=function(){function t(t){this.nodes=t}return t}();var game;game=new Phaser.Game(800,600,Phaser.AUTO,"phaser-stage"),game.state.add("menu",Menu),game.state.add("play",Play),game.state.start("menu");